<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Trello, Sofiane FARRAI, Maël Barbe</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    
    <div x-data="{
        tasks: [],
        newTask: {
            title: '',
            description: ''
        },
        editingId: null,
        filterStatus: 'Tous',
        searchQuery: '',
        init() {
            const saved = localStorage.getItem('tasks');
            if (saved) {
                this.tasks = JSON.parse(saved);
            } else {
                this.tasks = [
                    { id: 1, title: 'Apprendre Alpine.js', description: 'Faire le TP noté', status: 'À faire' },
                    { id: 2, title: 'Créer le projet', description: 'blablabla', status: 'En cours' },
                    { id: 3, title: 'slkddf', description: 'dfkjsdkjdlkgjl', status: 'À faire' }
                ];
                this.saveTasks();
            }
        },
        saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(this.tasks));
        },
        addTask() {
            this.tasks.push({
                id: Date.now(),
                title: this.newTask.title,
                description: this.newTask.description,
                status: 'À faire'
            });
            this.newTask.title = '';
            this.newTask.description = '';
            this.saveTasks();
        },
        deleteTask(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette tâche ?')) {
                this.tasks = this.tasks.filter(task => task.id !== id);
                this.saveTasks();
            }
        },
        editTask(id) {
            this.editingId = id;
        },
        updateTask(task) {
            this.editingId = null;
            this.saveTasks();
        },
        changeStatus(task, newStatus) {
            task.status = newStatus;
            this.saveTasks();
        },
        get filteredTasks() {
            let filtered = this.tasks;
            if (this.filterStatus !== 'Tous') {
                filtered = filtered.filter(task => task.status === this.filterStatus);
            }
            if (this.searchQuery) {
                filtered = filtered.filter(task => 
                    task.title.toLowerCase().includes(this.searchQuery.toLowerCase())
                );
            }
            return filtered;
        },
        countByStatus(status) {
            return this.tasks.filter(task => task.status === status).length;
        }
    }">
        <h1>Gestion de Mini trello</h1>

        <div>
            <input type="text" x-model="searchQuery" placeholder="Rechercher une tâche...">
        </div>

        <div>
            <button @click="filterStatus = 'Tous'">Tous (<span x-text="tasks.length"></span>)</button>
            <button @click="filterStatus = 'À faire'">À faire (<span x-text="countByStatus('À faire')"></span>)</button>
            <button @click="filterStatus = 'En cours'">En cours (<span x-text="countByStatus('En cours')"></span>)</button>
            <button @click="filterStatus = 'Terminé'">Terminé (<span x-text="countByStatus('Terminé')"></span>)</button>
        </div>

        <form @submit.prevent="addTask">
            <div>
                <label>Titre</label>
                <input type="text" x-model="newTask.title" required>
            </div>
            <div>
                <label>Description</label>
                <textarea x-model="newTask.description" required></textarea>
            </div>
            <button type="submit">Ajouter</button>
        </form>

        <div>
            <template x-for="task in filteredTasks" :key="task.id">
                <div>
                    <template x-if="editingId === task.id">
                        <div>
                            <input type="text" x-model="task.title">
                            <textarea x-model="task.description"></textarea>
                            <select x-model="task.status">
                                <option>À faire</option>
                                <option>En cours</option>
                                <option>Terminé</option>
                            </select>
                            <button @click="updateTask(task)">Sauvegarder</button>
                        </div>
                    </template>
                    <template x-if="editingId !== task.id">
                        <div>
                            <h3 x-text="task.title"></h3>
                            <p x-text="task.description"></p>
                            <select x-model="task.status" @change="changeStatus(task, task.status)">
                                <option>À faire</option>
                                <option>En cours</option>
                                <option>Terminé</option>
                            </select>
                            <button @click="editTask(task.id)">Modifier</button>
                            <button @click="deleteTask(task.id)">Supprimer</button>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </div>

</body>
</html>